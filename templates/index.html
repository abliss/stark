<!DOCTYPE html>
<html>
<head>

<title>Stark - the open visual mud</title>

<link type="text/css" href="/static/css/style.css" rel="stylesheet"/>
<link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />

<script type="text/javascript" src="http://jqueryui.com/latest/jquery-1.3.2.js"></script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.core.js"></script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.draggable.js"></script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.resizable.js"></script>
<script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.dialog.js"></script>

<script language="javascript" src="/static/js/lib/processing.js"></script>

<script type="text/javascript" src="/static/js/builder.js"></script>
<script type="text/javascript" src="/static/js/commands.js"></script>
<script type="text/javascript" src="/static/js/communications.js"></script>
<script type="text/javascript" src="/static/js/data.js"></script>
<script type="text/javascript" src="/static/js/inspect.js"></script>
<script type="text/javascript" src="/static/js/items.js"></script>
<script type="text/javascript" src="/static/js/player.js"></script>
<script type="text/javascript" src="/static/js/room.js"></script>
<script type="text/javascript" src="/static/js/utils.js"></script>

</head>
<body>

<div id="menu" style="margin: 0 0 5px 5px;">
    Welcome to Stark
    <a href="http://github.com/teebes/stark/">source code</a>
    | <a href="http://stark.teebes.com/doc">documentation</a>
    | <a href="http://github.com/teebes/stark/issues">issues</a>
</div>

<!-- communications -->
<div id="communications">
</div> 

<div id="left_pane">

<!-- commands -->

    <div id="input_bar">
        <div id="input_feedback" style="display: none">Test error message</div>
        <input id="command_text" type='text' /> <br />
        <input id="submit_command" type='submit' value='Enter' />
        
        <table border='0'>
            <tr>
                <td></td>
                <td><input id="move_north" type='submit' value='North' /></td>
                <td></td>
            </tr>
            <tr>
                <td><input id="move_west" type='submit' value='West' /></td>
                <td></td>
                <td><input id="move_east" type='submit' value='East' /></td>
            </tr>
            <tr>
                <td></td>
                <td><input id="move_south" type='submit' value='South' /></td>
                <td></td>
            </tr>
        </table>
    </div>

<!-- map -->

    <canvas id="map" width="300px" height="300px"></canvas>
</div>

<div id="right_pane">
    
<!-- player -->
    
    <div id="profile_box" class='page'>
        <div>
        {% if player.temporary %}
            <a href="{% url profile %}">save this character</a> | <a href="{% url logout_login %}">login</a>
        {% else %}
            <a href="{% url logout_login %}">logout</a>
        {% endif %}
        </div>
        
        <div>
        <strong id="player_name"></strong>, level <span id="player_level"></span>
        </div>
        
        <div>Movement Points: <span id="mp"></span></div>
        
        <br />Inventory:
        <div id="player_inventory"></div>
        
    </div>    
    
<!-- room -->
    
    <div id="room_box" class='page'>
        <h2 id="room_title"></h2>
        <p id="room_desc"></p>
        <div id="room_items"></div>
        <div id="room_mobs"></div>        
        <div id="room_players"></div>
    </div>

<!-- builder -->

    <div id="builder_box" class='page' style='display: none;'>
        <p>coords <span id="builder_x"></span>, <span id="builder_y"></span></p>
        
        <p>title: <input type='text' id="builder_room_title" /></p>
        <p>description:</p>
        
        <textarea id="builder_room_description"></textarea>
        
        <p>Connectors:</p>
        
        <p><input type='checkbox' id="builder_north" /> north</p>
        <p><input type='checkbox' id="builder_east" /> east</p>
        <p><input type='checkbox' id="builder_south" /> south</p>
        <p><input type='checkbox' id="builder_west" /> west</p>
        
        <p>type:
            <select name='room_type' id="builder_room_type">
                <option value=''></option>
                <option value='road'>Road</option>
                <option value='water'>Water</option>
                <option value='field'>Field</option>
                <option value='city'>City</option>
                <option value='shop'>Shop</option>
            </select>
        </p>
        
        <p>
            x: <input type='text' id="jump_x" style='width: 30px;' />
            y: <input type='text' id="jump_y" style='width: 30px;' />
            <input type='submit' id='jump_to' value='Jump To' />
            <input type='submit' id='create_room' value='Create Room' />
        </p>
        
        <p><input type='submit' id='delete_room' value='Delete Room'/></p>
        
    </div>
        
</div>

<div style="clear: both;"></div>

<div id="dialog" title="Dialog Title"></div>


<script type='text/javascript'>
$(document).ready(function(){
    
    $("#dialog").dialog({ autoOpen: false });
    
    // initial data
    document.map = [];
    document.player = null;
    
    setup_commands();
    setup_builder();

    get_map();

    var initial = true;

    pulse = function() {
        render_communications();
        
        $.getJSON("/api/players/me.json", function(player) {
            document.player = player;
            
            get_map();
            
            // render the pages
            render_room();
            render_profile();
            
            if (initial) {
                // functions to only execute once on initial load
                if (document.player.builder_mode) {
                    render_builder(); }
                initial = false;
            }
            
        });           
    }
    pulse();
    setInterval("pulse();", 2000);

    // processing
    var script = $.ajax({url: "/static/js/rendermap.pjs", async: false}).responseText;
    var canvas = $('canvas#map').get(0);
    Processing(canvas, script);
});

</script>

</body>
</html>